---
layout: post
title: Oracle培训笔记二
description: 记录oracle要点
category: blog
---

## 要点四：批量导入数据

**从txt文本中导入数据到oracle**

用到的命令为：**sqlldr**

准备工作：

- 数据源文件（data.txt）

![数据源](/images/oracle/data.jpg)

- 制作ctl文件（1.ctl）

```
load data 
infile 'c:\Test\data.txt' // 数据文件的位置
(append)replace into table stu1   // (追加)替换stu1表中的数据
fields terminated by "," optionally enclosed "" //用逗号作为列分隔符
(id,name,age,email) //字段名

```
- 运行命令

```
1.导入前

SQL> select * from stu1; //无数据

     ID    NAME                 EMAIL            AGE
 -------  ------                --------          ------                             

2.导入操作

C:\>sqlldr test/123 control=c:\Test\1.ctl   //命令语法：test/123为账户，然后是控制文件的路径

SQL*Loader: Release 11.2.0.1.0 - Production on 星期五 7月 25 11:11:22 2014

Copyright (c) 1982, 2009, Oracle and/or its affiliates.  All rights reserved.

达到提交点 - 逻辑记录计数 3
达到提交点 - 逻辑记录计数 4

3. 导入后

SQL> select * from stu1; //有数据

         ID      NAME                 EMAIL                    AGE
    ------- ------------- ------------------        -----------------
         1      java1                java1@126.com             18
         2      java2                java2@126.com             45
         3      java3                java3@126.com             56
         100    java100              java100@126.com           67

```
**从excel表中导入数据**

用到的软件：**XlsToOra**

ps：只能导入xls文件，xlsx文件需进行转换。

## 常用命令

**复制表**

```
SQL> create table emp as select * from scott.emp; // 该账户先要有resource权限和scott.emp的select权限

Table created

SQL> select * from emp;  //有表结构和数据

EMPNO ENAME      JOB         MGR HIREDATE          SAL      COMM DEPTNO
----- ---------- --------- ----- ----------- --------- --------- ------
 7369 SMITH      CLERK      7902 1980-12-17     800.00               20
 7499 ALLEN      SALESMAN   7698 1981-2-20     1600.00    300.00     30
 7521 WARD       SALESMAN   7698 1981-2-22     1250.00    500.00     30
 7566 JONES      MANAGER    7839 1981-4-2      2975.00               20
 7654 MARTIN     SALESMAN   7698 1981-9-28     1250.00   1400.00     30
 7698 BLAKE      MANAGER    7839 1981-5-1      2850.00               30
 7782 CLARK      MANAGER    7839 1981-6-9      2450.00               10
 7788 SCOTT      ANALYST    7566 1987-4-19     3000.00               20
 7839 KING       PRESIDENT       1981-11-17    5000.00               10
 7844 TURNER     SALESMAN   7698 1981-9-8      1500.00      0.00     30
 7876 ADAMS      CLERK      7788 1987-5-23     1100.00               20
 7900 JAMES      CLERK      7698 1981-12-3      950.00               30
 7902 FORD       ANALYST    7566 1981-12-3     3000.00               20
 7934 MILLER     CLERK      7782 1982-1-23     1300.00               10

14 rows selected
```

**仅复制表结构**

```
SQL> create table dept as select * from scott.dept where 1=2;

Table created

SQL> select * from dept; //有表结构，无数据

DEPTNO DNAME          LOC
------ -------------- -------------
```

**查询是否空值（is null， is not null）**

```
SQL> select * from emp where comm is not null;  //查询comm字段不为空值的数据

EMPNO ENAME      JOB         MGR HIREDATE          SAL      COMM DEPTNO
----- ---------- --------- ----- ----------- --------- --------- ------
 7499 ALLEN      SALESMAN   7698 1981-2-20     1600.00    300.00     30
 7521 WARD       SALESMAN   7698 1981-2-22     1250.00    500.00     30
 7654 MARTIN     SALESMAN   7698 1981-9-28     1250.00   1400.00     30
 7844 TURNER     SALESMAN   7698 1981-9-8      1500.00      0.00     30

```
**别名**

```
SQL> select dname bumenmc from dept;  //dname别名为bumenmc，bumenmc名称前可加as，也可不加

BUMENMC
--------------
ACCOUNTING
RESEARCH
SALES
OPERATIONS
```
**拼接**

```
SQL> select dname||'CN' from dept;

DNAME||'CN'
----------------
ACCOUNTINGCN // 查询的值后面都追加了'CN'
RESEARCHCN
SALESCN
OPERATIONSCN
```
**过滤重复（distinct）**

```
SQL> select job from emp; // 直接查询

JOB
---------
CLERK
SALESMAN
SALESMAN
MANAGER
SALESMAN
MANAGER
MANAGER
ANALYST
PRESIDENT
SALESMAN
CLERK
CLERK
ANALYST
CLERK

14 rows selected

SQL> select distinct job from emp; //过滤查询，distinct关键字

JOB
---------
CLERK
SALESMAN
PRESIDENT
MANAGER
ANALYST

```
**oracle中的不等于（<>）**

```
SQL> select * from emp where job <>'SALESMAN';

EMPNO ENAME      JOB         MGR HIREDATE          SAL      COMM DEPTNO
----- ---------- --------- ----- ----------- --------- --------- ------
 7369 SMITH      CLERK      7902 1980-12-17     800.00               20
 7566 JONES      MANAGER    7839 1981-4-2      2975.00               20
 7698 BLAKE      MANAGER    7839 1981-5-1      2850.00               30
 7782 CLARK      MANAGER    7839 1981-6-9      2450.00               10
 7788 SCOTT      ANALYST    7566 1987-4-19     3000.00               20
 7839 KING       PRESIDENT       1981-11-17    5000.00               10
 7876 ADAMS      CLERK      7788 1987-5-23     1100.00               20
 7900 JAMES      CLERK      7698 1981-12-3      950.00               30
 7902 FORD       ANALYST    7566 1981-12-3     3000.00               20
 7934 MILLER     CLERK      7782 1982-1-23     1300.00               10

10 rows selected
```
**区间（between and）**

```
SQL> select * from emp where sal between 2450 and 3000; //是包含两端的边界值的

EMPNO ENAME      JOB         MGR HIREDATE          SAL      COMM DEPTNO
----- ---------- --------- ----- ----------- --------- --------- ------
 7566 JONES      MANAGER    7839 1981-4-2      2975.00               20
 7698 BLAKE      MANAGER    7839 1981-5-1      2850.00               30
 7782 CLARK      MANAGER    7839 1981-6-9      2450.00               10
 7788 SCOTT      ANALYST    7566 1987-4-19     3000.00               20
 7902 FORD       ANALYST    7566 1981-12-3     3000.00               20
```
**升降序（asc，desc）**

```
SQL> select * from emp where sal between 2450 and 3000 order by sal; //默认是升序排列

EMPNO ENAME      JOB         MGR HIREDATE          SAL      COMM DEPTNO
----- ---------- --------- ----- ----------- --------- --------- ------
 7782 CLARK      MANAGER    7839 1981-6-9      2450.00               10
 7698 BLAKE      MANAGER    7839 1981-5-1      2850.00               30
 7566 JONES      MANAGER    7839 1981-4-2      2975.00               20
 7902 FORD       ANALYST    7566 1981-12-3     3000.00               20
 7788 SCOTT      ANALYST    7566 1987-4-19     3000.00               20

SQL> select * from emp where sal between 2450 and 3000 order by sal desc; //按sal的降序排列

EMPNO ENAME      JOB         MGR HIREDATE          SAL      COMM DEPTNO
----- ---------- --------- ----- ----------- --------- --------- ------
 7902 FORD       ANALYST    7566 1981-12-3     3000.00               20
 7788 SCOTT      ANALYST    7566 1987-4-19     3000.00               20
 7566 JONES      MANAGER    7839 1981-4-2      2975.00               20
 7698 BLAKE      MANAGER    7839 1981-5-1      2850.00               30
 7782 CLARK      MANAGER    7839 1981-6-9      2450.00               10
```
**count函数**

```
SQL> select count(\*) from emp; //查询emp多少条记录

  COUNT(\*)
----------
        14

SQL> select count(job) from emp;

COUNT(JOB)
----------
        14

SQL> select count(comm) from emp; 

COUNT(COMM)
-----------
          4

ps：count函数查询是不包含空值的。亦即统计空值。
```

